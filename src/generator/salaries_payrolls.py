import datetime
from dateutil.relativedelta import relativedelta

departments = [
    {
        "ids": [2, 8, 14, 20, 26, 32, 38, 44, 50, 56, 62, 68, 74, 80, 86, 92, 98, 104],
        "salary": 2000
    },
    {
        "ids": [1, 7, 13, 19, 25, 31, 37, 43, 49, 55, 61, 67, 73, 79, 85, 91, 97, 103],
        "salary": 1800
    },
    {
        "ids": [3, 9, 15, 21, 27, 33, 39, 45, 51, 57, 63, 69, 75, 81, 87, 93, 99, 105],
        "salary": 1700
    },
    {
        "ids": [4, 10, 16, 22, 28, 34, 40, 46, 52, 58, 64, 70, 76, 82, 88, 94, 100, 106],
        "salary": 1700
    },
    {
        "ids": [5, 11, 17, 23, 29, 35, 41, 47, 53, 59, 65, 71, 77, 83, 89, 95, 101, 107],
        "salary": 5000
    },
    {
        "ids": [6, 12, 18, 24, 30, 36, 42, 48, 54, 60, 66, 72, 78, 84, 90, 96, 102, 108],
        "salary": 1700
    },
]

employees_departments = [
    [2, 5, '2019-09-21'],
    [3, 11, '2020-11-09'],
    [8, 17, '2020-11-13'],
    [12, 23, '2020-03-03'],
    [13, 29, '2020-07-09'],
    [14, 35, '2020-06-29'],
    [17, 41, '2019-08-05'],
    [19, 47, '2021-04-18'],
    [20, 53, '2019-10-15'],
    [21, 59, '2020-12-09'],
    [22, 65, '2020-03-29'],
    [23, 71, '2020-11-28'],
    [26, 77, '2020-10-17'],
    [29, 83, '2021-05-28'],
    [31, 89, '2020-08-24'],
    [32, 95, '2020-03-19'],
    [37, 101, '2020-11-17'],
    [39, 107, '2020-10-27'],
    [1, 1, '2020-04-04'],
    [4, 2, '2021-05-31'],
    [5, 3, '2020-04-15'],
    [6, 4, '2021-05-17'],
    [7, 6, '2021-05-26'],
    [9, 7, '2021-03-12'],
    [10, 8, '2019-09-19'],
    [11, 9, '2019-10-22'],
    [15, 10, '2021-05-03'],
    [16, 12, '2019-11-03'],
    [18, 13, '2021-05-29'],
    [24, 14, '2020-09-06'],
    [25, 15, '2020-12-06'],
    [27, 16, '2020-06-25'],
    [28, 18, '2020-04-09'],
    [30, 19, '2020-03-02'],
    [33, 20, '2020-05-08'],
    [34, 21, '2020-11-06'],
    [35, 22, '2020-07-18'],
    [36, 24, '2020-02-15'],
    [38, 25, '2019-12-06'],
    [40, 26, '2021-06-15'],
    [41, 27, '2020-08-19'],
    [42, 28, '2021-03-10'],
    [43, 30, '2021-03-07'],
    [44, 31, '2019-11-18'],
    [45, 32, '2020-10-16'],
    [46, 33, '2020-10-02'],
    [47, 34, '2020-06-01'],
    [48, 36, '2021-03-27'],
    [49, 37, '2020-02-10'],
    [50, 38, '2021-01-13'],
    [51, 39, '2021-01-05'],
    [52, 40, '2021-01-26'],
    [53, 42, '2020-05-11'],
    [54, 43, '2020-09-19'],
    [55, 44, '2020-11-29'],
    [56, 45, '2020-01-06'],
    [57, 46, '2021-01-19'],
    [58, 48, '2019-09-28'],
    [59, 49, '2020-04-13'],
    [60, 50, '2021-01-20'],
    [61, 51, '2020-04-11'],
    [62, 52, '2021-04-22'],
    [63, 54, '2020-03-08'],
    [64, 55, '2019-11-18'],
    [65, 56, '2020-04-10'],
    [66, 57, '2021-02-25'],
    [67, 58, '2020-12-21'],
    [68, 60, '2020-03-15'],
    [69, 61, '2020-09-01'],
    [70, 62, '2019-10-05'],
    [71, 63, '2021-05-01'],
    [72, 64, '2019-10-06'],
    [73, 66, '2020-10-26'],
    [74, 67, '2020-01-21'],
    [75, 68, '2019-09-30'],
    [76, 69, '2020-08-31'],
    [77, 70, '2019-10-04'],
    [78, 72, '2020-07-16'],
    [79, 73, '2019-09-30'],
    [80, 74, '2019-12-03'],
    [81, 75, '2020-12-11'],
    [82, 76, '2020-01-31'],
    [83, 78, '2021-06-06'],
    [84, 79, '2020-06-17'],
    [85, 80, '2020-07-08'],
    [86, 81, '2021-01-29'],
    [87, 82, '2021-01-24'],
    [88, 84, '2020-05-13'],
    [89, 85, '2020-08-12'],
    [90, 86, '2019-12-02'],
    [91, 87, '2019-08-31'],
    [92, 88, '2019-12-28'],
    [93, 90, '2020-06-16'],
    [94, 91, '2021-04-29'],
    [95, 92, '2021-01-23'],
    [96, 93, '2019-09-29'],
    [97, 94, '2020-07-30'],
    [98, 96, '2020-12-21'],
    [99, 97, '2020-12-05'],
    [100, 98, '2020-07-19'],
    [101, 99, '2021-04-22'],
    [102, 100, '2020-03-08'],
    [103, 102, '2019-11-18'],
    [104, 103, '2020-04-10'],
    [105, 104, '2021-02-25'],
    [106, 105, '2020-12-21'],
    [107, 106, '2020-03-15'],
    [108, 108, '2020-09-01'],
    [109, 1, '2019-10-05'],
    [110, 2, '2021-05-01'],
    [111, 3, '2019-10-06'],
    [112, 4, '2020-10-26'],
    [113, 6, '2020-01-21'],
    [114, 7, '2019-09-30'],
    [115, 8, '2020-08-31'],
    [116, 9, '2019-10-04'],
    [117, 10, '2020-07-16'],
    [118, 12, '2019-09-30'],
    [119, 13, '2019-12-03'],
    [120, 14, '2020-12-11'],
    [121, 15, '2020-01-31'],
    [122, 16, '2021-06-06'],
    [123, 18, '2020-06-17'],
    [124, 19, '2020-07-08'],
    [125, 20, '2021-01-29'],
    [126, 21, '2021-01-24'],
    [127, 22, '2020-05-13'],
    [128, 24, '2020-08-12'],
    [129, 25, '2019-12-02'],
    [130, 26, '2019-08-31'],
    [131, 27, '2019-12-28'],
    [132, 28, '2020-06-16'],
    [133, 30, '2021-04-29'],
    [134, 31, '2021-01-23'],
    [135, 32, '2019-09-29'],
    [136, 33, '2020-07-30'],
    [137, 34, '2020-12-21'],
    [138, 36, '2020-12-05'],
    [139, 37, '2020-07-19'],
    [140, 38, '2020-12-07'],
    [141, 39, '2021-05-03'],
    [142, 40, '2020-03-06'],
    [143, 42, '2020-04-04'],
    [144, 43, '2020-05-01'],
    [145, 44, '2019-12-31'],
    [146, 45, '2020-02-28'],
    [147, 46, '2019-11-07'],
    [148, 48, '2020-12-15'],
    [149, 49, '2020-01-24'],
    [150, 50, '2020-06-21'],
    [151, 51, '2021-01-27'],
    [152, 52, '2021-01-21'],
    [153, 54, '2019-09-03'],
    [154, 55, '2020-12-15'],
    [155, 56, '2021-02-20'],
    [156, 57, '2021-05-08'],
    [157, 58, '2019-11-03'],
    [158, 60, '2020-12-18'],
    [159, 61, '2020-11-01'],
    [160, 62, '2020-03-25'],
    [161, 63, '2020-11-07'],
    [162, 64, '2020-08-11'],
    [163, 66, '2020-01-18'],
    [164, 67, '2019-09-18'],
    [165, 68, '2020-10-11'],
    [166, 69, '2020-11-23'],
    [167, 70, '2019-10-17'],
    [168, 72, '2020-08-01'],
    [169, 73, '2020-09-16'],
    [170, 74, '2020-07-01'],
    [171, 75, '2020-12-06'],
    [172, 76, '2020-02-14'],
    [173, 78, '2020-06-27'],
    [174, 79, '2021-02-20'],
    [175, 80, '2020-05-12'],
    [176, 81, '2020-12-12'],
    [177, 82, '2020-03-24'],
    [178, 84, '2020-10-31'],
    [179, 85, '2020-05-24'],
    [180, 86, '2021-04-21'],
    [181, 87, '2021-01-01'],
    [182, 88, '2021-05-17'],
    [183, 90, '2019-09-22'],
    [184, 91, '2020-10-26'],
    [185, 92, '2020-02-27'],
    [186, 93, '2020-07-12'],
    [187, 94, '2020-02-17'],
    [188, 96, '2019-10-21'],
    [189, 97, '2021-06-05'],
    [190, 98, '2021-01-16'],
    [191, 99, '2019-10-20'],
    [192, 100, '2020-05-27'],
    [193, 102, '2021-01-05'],
    [194, 103, '2019-10-17'],
    [195, 104, '2020-03-15'],
    [196, 105, '2020-08-13'],
    [197, 106, '2019-11-18'],
    [198, 108, '2020-01-08'],
]

final_salaries = []
payrolls = []
payroll_items = []
today = datetime.datetime.now()
plus_month = relativedelta(months=1)
minus_day = relativedelta(days=1)
payroll_id = 1

for ed in employees_departments:
    salary_line = [x for x in departments if ed[1] in x['ids']]
    salary = salary_line[0]['salary']
    split_date = ed[2].split('-')
    next_salary = datetime.datetime(int(split_date[0]), int(split_date[1]), 5) + plus_month

    final_salaries.append(
        {
            "employee_id": ed[0],
            "line": f"INSERT INTO salary VALUES (DEFAULT, {ed[0]}, {salary}, '{ed[2]}', NULL);"
        }
    )

    while next_salary < today:
        while next_salary.weekday() > 4:
            next_salary = next_salary - minus_day

        payrolls.append(
            {
                "employee_id": ed[0],
                "payroll_id": payroll_id,
                "line": f"INSERT INTO payroll VALUES(DEFAULT, {ed[0]}, {salary}, true, '{next_salary.strftime('%Y-%m-%d')}');"
            }
        )

        payroll_items.append(
            {
                "payroll_id": payroll_id,
                "line": f"INSERT INTO payroll_item VALUES(DEFAULT, {payroll_id}, 'Sal√°rio', 'salary', {salary});"
            }
        )

        payroll_id += 1
        next_salary = next_salary.replace(day=5)
        next_salary = next_salary + plus_month

for final in final_salaries:
    print(final["line"])
    for payroll in payrolls:
        if payroll['employee_id'] != final['employee_id']:
            continue
        print(payroll["line"])

        for payroll_item in payroll_items:
            if payroll_item['payroll_id'] != payroll['payroll_id']:
                continue
            print(payroll_item["line"])
    print("-- END EPLOYEE")


